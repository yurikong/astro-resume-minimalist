---
import BaseLayout from "~layouts/BaseLayout.astro"
import AppLink from "~components/AppLink.astro"
import ToggleColorScheme from "~components/ToggleColorScheme.astro"
import { getAllProjects } from "~api/project"
import type { IProject } from "~types/project"
import YearRange from "~components/YearRange.astro"
import Tag from "~components/Tag.astro"

const projects: IProject[] = []

try {
  const projectList: IProject[] = await getAllProjects()
  projects.push(...projectList)
} catch (error) {
  console.error(error)
}
---

<BaseLayout>
  <div class:list={["py-5", "md: py-8"]}>
    <!-- Nav -->
    <nav class:list={["flex", "items-center", "justify-between", "mb-2", "md:mb-4"]}>
      <AppLink
        class:list={["leading-tight", "lowercase"]}
        url="/"
        showPrefixIcon
        prefixIconClassName="i-ri:arrow-left-line"
      >
        back
      </AppLink>

      <ToggleColorScheme class="text-xl" />
    </nav>

    <!-- Page Title -->
    <h1
      class:list={[
        "font-medium",
        "tracking-tight",
        "capitalize",
        "text-4xl",
        "sm:text-5xl",
        "text-gray-800",
        "dark:text-gray-300",
      ]}
    >
      all projects
    </h1>

    <!-- Project Archives -->
    <table class:list={["text-left", "mt-12", "w-full"]}>
      <thead>
        <tr class:list={["sticky", "top-0", "z-20", "capitalize"]}>
          <!-- Year -->
          <th
            class:list={[
              "py-4",
              "pr-8",
              "font-medium",
              "leading-snug",
              "text-sm",
              "text-gray-800",
              "dark:text-gray-300",
              "bg-gray-100",
              "dark:bg-gray-900",
            ]}
          >
            Year
          </th>

          <!-- Project -->
          <th
            class:list={[
              "py-4",
              "pr-8",
              "font-medium",
              "leading-snug",
              "text-sm",
              "text-gray-800",
              "dark:text-gray-300",
              "bg-gray-100",
              "dark:bg-gray-900",
            ]}
          >
            Project
          </th>

          <!-- Made at -->
          <th
            class:list={[
              "py-4",
              "pr-8",
              "font-medium",
              "leading-snug",
              "text-sm",
              "text-gray-800",
              "dark:text-gray-300",
              "bg-gray-100",
              "dark:bg-gray-900",
              "hidden",
              "lg:table-cell",
            ]}
          >
            Made at
          </th>

          <!-- Technologies Used -->
          <th
            class:list={[
              "py-4",
              "pr-8",
              "font-medium",
              "leading-snug",
              "text-sm",
              "text-gray-800",
              "dark:text-gray-300",
              "bg-gray-100",
              "dark:bg-gray-900",
              "hidden",
              "lg:table-cell",
            ]}
          >
            Technologies Used
          </th>

          <!-- Link -->
          <th
            class:list={[
              "py-4",
              "pr-8",
              "font-medium",
              "leading-snug",
              "text-sm",
              "text-gray-800",
              "dark:text-gray-300",
              "bg-gray-100",
              "dark:bg-gray-900",
              "hidden",
              "sm:table-cell",
            ]}
          >
            Link
          </th>
        </tr>
      </thead>

      <tbody>
        {
          projects.map((it) => (
            <tr class:list={["border-b", "last:border-none", "border-gray-800/10", "dark:border-gray-100/10"]}>
              {/* Year */}
              <td class:list={["align-top", "text-sm", "leading-snug", "capitalize", "py-4", "pr-4"]}>
                <YearRange startYear={it.startYear} endYear={it.endYear} />
              </td>

              {/* Project */}
              <td
                class:list={[
                  "align-top",
                  "font-medium",
                  "leading-snug",
                  "text-gray-800",
                  "dark:text-gray-300",
                  "py-4",
                  "pr-4",
                ]}
              >
                <AppLink class="sm:hidden" url={it.link?.url} showSuffixIcon={!!it.link}>
                  {it.name}
                </AppLink>
                <div class:list={["hidden", "sm:block"]}>{it.name}</div>
              </td>

              {/* Made at */}
              <td class:list={["align-top", "font-medium", "leading-snug", "py-4", "pr-4", "hidden", "lg:table-cell"]}>
                {it.madeAt}
              </td>

              {/* Technologies Used */}
              <td class:list={["align-top", "font-medium", "leading-snug", "py-4", "pr-4", "hidden", "lg:table-cell"]}>
                <ul class:list={["flex", "flex-wrap", "gap-x-1.5", "gap-y-1"]}>
                  {it.technologiesUsed.map((it) => (
                    <li>
                      <Tag text={it} />
                    </li>
                  ))}
                </ul>
              </td>

              {/* Link */}
              <td class:list={["align-top", "font-medium", "leading-snug", "py-4", "pr-4", "hidden", "sm:table-cell"]}>
                <AppLink url={it.link?.url} showSuffixIcon={!!it.link} suffixIconClassName={it.link?.iconClassName}>
                  {it.link?.displayText}
                </AppLink>
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</BaseLayout>
